<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymelead.org">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>olx</title>

    <script> src = "https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
    <script> src = "https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"</script>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="styles.css">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>

</head>

<body>



    <div id="telaHome">

        <div class="jumbotron mb-0 mt-4">
            <h1 class="display-4">OLX</h1>
        </div>

        <div class="container"> </div>
        <nav class="navbar navbar-expand navbar-light bg-light d-flex justify-content-between mb-3" id="top-menu">
            <div class="navbar-nav">
                <a class="nav-item nav-link" href="/#">Todos</a>
                <a class="nav-item nav-link" href="/#">Aguardando</a>
                <a class="nav-item nav-link" href="/#">Aprovado</a>
                <a class="nav-item nav-link" href="/#">Entregue</a>
            </div>
            <a href="http://localhost:3000/novoproduto"><button
                    class="btn btn-outline-secondary my-2 my-sm-0 newproduct">Novo produto</button></a>
        </nav>
        <nav class="navbar navbar-light">
            <form class="form-inline" id="searchbar">
                <input class="form-control mr-sm-2" id="searchinput" type="search" placeholder="Buscar produto"
                    aria-label="Search">
                <button class="btn btn-outline-light my-2 my-sm-0" type="submit">Buscar</button>
            </form>
        </nav>


        <div class="gambeta"></div>
    </div>

    
    <script src="./cookies.js"></script>

    <script type="text/javascript">

        var socket = io('http://localhost:3000', {
            query: {
                token: getCookie('token')
            }
        });

        $('#usernameForm').submit(function (event) {
            event.preventDefault();

            var nameusuario = $('input[name=nameusuario]').val();
            console.log(nameusuario);

            goToHome();


        });

        function goToHome(produto) {

            var stylelogin = document.querySelector('#stylelogin');
            stylelogin.classList.remove('href');
            //hidden da tela login
            var telaLogin = document.querySelector('#telaLogin');
            telaLogin.classList.add('hidden');
            //remove hidden da tela menu
            var telaHome = document.querySelector('#telaHome');
            telaHome.classList.remove('hidden');
        }

        function fillProduto(produto) {
            var queryString = "?nome=" + produto.nomeProduto + "&descricao=" + produto.descricao + "&valor=" + produto.valorProduto + "&img=" + produto.urlImagem + "&donoId=" + produto.donoId;
            queryString = queryString.replace(/ /g, "+");

            $('.gambeta').append('<div class="card mb-3"><div class="card-body"><div class="row"><div class="col-12 col-sm-8 mb-3"><div class="valor "><div class="col">Valor: <span >' + produto.valorProduto + '</span></div></div><div class="Nomeproduto "><div class="col"> <a class="nome-produto-link" href=produto.html' + queryString + '> <h4 >' + produto.nomeProduto + '</h4></a></div></div> <div class = "descricao"><div>Descrição</div> <textarea class="form-control" >' + produto.descricao + '</textarea></div>               </div>  <div class="col-12 col-sm-4"><div class = "img"><img class="img-thumbnail"  src="' + produto.urlImagem + '" /></div></div>           </div></div></div>');

            //$('.valor').append('<div class="valor "><div class="col">Valor: <span >'+ produto.valorProduto+'</span></div></div>');
            //$('.Nomeproduto').append('<div class="Nomeproduto "><div class="col"> <h4 >'+ produto.nomeProduto+'</h4></div></div>');
            //$('.Urlproduto').append(' <div class="Urlproduto "><input class="form-control"  value="'+produto.urlProduto+'" /></div></div>');
            //$('.descricao').append('<div class = "descricao"><div>Descrição</div> <textarea class="form-control" >'+produto.descricao + '</textarea></div>');
            //$('.img').append('<div class="col-12 col-sm-4"><div class = "img"><img class="img-thumbnail"  src="'+produto.urlImagem+'" /></div></div>');  
        }
        var nomeUsuario;

        socket.on('receivedProdutos', function (produto) {
            fillProduto(produto);
        });

        socket.on('recebeAvaliacao', (data) => {
            console.log(data)
            alert('recebeu um voto: ' + JSON.stringify(data));
        })

        socket.on('previousprodutos', function (produtos) {
            for (produto of produtos) {
                fillProduto(produto);
            }
        });

    </script>


</body>

</html>