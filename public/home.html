<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymelead.org">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>olx</title>

    <script> src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
    <script> src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"</script>
    <script src="/socket.io/socket.io.js"></script>

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

</head>
<body>	

   <div id="primeirapagina">
    <div  class="jumbotron mb-0 mt-4">
        <h1 class="display-4" >OLX</h1>
    </div>

    <div class="container"> </div>
    <nav class="navbar navbar-expand navbar-light bg-light d-flex justify-content-between mb-3" id="top-menu">
        <div class="navbar-nav">
            <a class="nav-item nav-link" href="/#">Todos</a>
            <a class="nav-item nav-link" href="/#">Aguardando</a>
            <a class="nav-item nav-link" href="/#">Aprovado</a>
            <a class="nav-item nav-link" href="/#">Entregue</a>
        </div>
        <a ><button class="btn btn-outline-secondary my-2 my-sm-0 newproduct" onclick="abrirNovoProduto()" type="button">Novo produto</button></a>
        <a ><button class="btn btn-outline-secondary my-2 my-sm-0" onclick="abrirchat()" type="button">chat</button></a>
    </nav>
    <nav class="navbar navbar-light">
        <form class="form-inline" id="searchbar">
            <input class="form-control mr-sm-2" id="searchinput" type="search" placeholder="Buscar produto" aria-label="Search">
            <button class="btn btn-outline-light my-2 my-sm-0"  type="button">Buscar</button>
        </form>
    </nav>

    <div class="gambeta"></div>
</div> 


<div id="telachat" class="hidden">
        <form id="chat">
            <input type="text" name ="username" id="inputUserName" placeholder="Digite seu usuário"> 
            <div class="messages"></div>
            <input type="text" name ="message" placeholder="Digite sua mensagem">
            <button type="submit">Enviar</button>
        </form>
</div>


<div id="telanovoproduto" class="hidden">

    <div  class="jumbotron mb-0 ">
        <h1 class="display-4" >Insira um novo produto</h1>
    </div>

    <div class="container">

        <div class="card mt-3">
            <form id="sendnovoproduto" class="card-body"  >
                <div class="form-group">
                    <label for="nomeProduto">Produto</label>
                    <input  name= "nomeProduto" class="form-control" placeholder="nome do produto"/>
                    <small>Informa qual o nome do produto.</small>
                    
                </div>
                <div class="form-group">
                    <label for="urlProduto">Url</label>
                    <input name= "urlProduto" class="form-control" placeholder="url do produto"/>
                    <small>Procure em um site o produto que você deseja e cole a url da página aqui.</small>
                    
                </div>
                <div class="form-group">
                    <label for="urlImagem">Imagem</label>
                    <input name= "urlImagem" class="form-control" placeholder="url da imagem"/>
                    <small>Copie a url de uma boa imagem do produto e cole aqui para ajudar a conseguir compradores.</small>
                
                </div>
                
                <div class="form-group">
                    <label for="valorProduto">Valor</label>
                    <input name= "valorProduto" class="form-control" placeholder="100,00"/>
                    <small>valor do produto</small>
                
                </div>
                
                <div class="form-group">
                    <label for="descricao">Descrição</label>
                    <textarea name="descricao" class="form-control" placeholder="Adicione detalhes importantes para ajudar o comprador."></textarea>
                </div>
                <a><button id = "botaocadastro" class="btn btn-primary" type="submit">Cadastrar</button></a>
            </form>
        </div>
    </div>




</div>








    <script type= "text/javascript">

       //---------------------------------------tela home ---------------------------

        function abrirchat() {
            //hidden na tela menu
            var primeirapagina = document.querySelector('#primeirapagina');
            primeirapagina.classList.add('hidden');
            //tira hidden ta tela chat
            var telachat = document.querySelector('#telachat');
            telachat.classList.remove('hidden');
        }

        function abrirNovoProduto() {
            //hidden na tela menu
            var primeirapagina = document.querySelector('#primeirapagina');
            primeirapagina.classList.add('hidden');
            //hidden ta tela chat
            var telachat = document.querySelector('#telachat');
            telachat.classList.add('hidden');
            //remove hidden ta tela novoproduto
            var telanovoproduto = document.querySelector('#telanovoproduto');
            telanovoproduto.classList.remove('hidden');
        }
    
        var socket = io('http://localhost:3000');
        
        function fillProduto(produto) {
                $('.gambeta').append('<div class="card mb-3"><div class="card-body"><div class="row"><div class="col-12 col-sm-8 mb-3"><div class="valor "><div class="col">Valor: <span >'+ produto.valorProduto+'</span></div></div><div class="Nomeproduto "><div class="col"> <a class="nome-produto-link" href="produto.html"> <h4 >'+ produto.nomeProduto+'</h4></a></div></div> <div class = "descricao"><div>Descrição</div> <textarea class="form-control" >'+produto.descricao + '</textarea></div>               </div>  <div class="col-12 col-sm-4"><div class = "img"><img class="img-thumbnail"  src="'+produto.urlImagem+'" /></div></div>           </div></div></div>');

            //$('.valor').append('<div class="valor "><div class="col">Valor: <span >'+ produto.valorProduto+'</span></div></div>');
            //$('.Nomeproduto').append('<div class="Nomeproduto "><div class="col"> <h4 >'+ produto.nomeProduto+'</h4></div></div>');
            //$('.Urlproduto').append(' <div class="Urlproduto "><input class="form-control"  value="'+produto.urlProduto+'" /></div></div>');
            //$('.descricao').append('<div class = "descricao"><div>Descrição</div> <textarea class="form-control" >'+produto.descricao + '</textarea></div>');
            //$('.img').append('<div class="col-12 col-sm-4"><div class = "img"><img class="img-thumbnail"  src="'+produto.urlImagem+'" /></div></div>');
        }
        
        socket.on('receivedProdutos', function(produto) {
            fillProduto(produto);
            });

        socket.on('previousprodutos', function(produtos) {
            for (produto of produtos){
                fillProduto(produto);
            }
        });


        //---------------------------------------CHAT---------------------------

        function renderMessage(message) {
            $('.messages').append('<div class="message"><strong>'+ message.author+'</strong>: '+ message.message+' </div> ');
        }

        socket.on('previousMessages', function(messages) {
            for (message of messages){
                renderMessage(message);
            }
        });

        socket.on('receivedMessage', function(message) {
            renderMessage(message);
        });

        $('#chat').submit(function(event) {
            event.preventDefault();
            var author = $('input[name=username]').val();
            var message = $('input[name=message]').val();

            if (author.length && message.length) {
                var messageObject = {
                    author: author,
                    message: message
                };
            } 

            renderMessage(messageObject);

            socket.emit('sendMessage', messageObject );
            $('input[name=message').val('');
            document.getElementById("inputUserName").disabled = true;
        })


        //---------------------------------------Criar produto---------------------------

        

        $('#sendnovoproduto').submit(function(event) {
                event.preventDefault();
                var nomeProduto= $('input[name=nomeProduto]').val();
                var urlProduto = $('input[name=urlProduto]').val();
                var urlImagem = $('input[name=urlImagem]').val();
                var valorProduto = $('input[name=valorProduto]').val();
                var descricao = $('textarea[name=descricao]').val();
    
                    var produtoObject = {
                        nomeProduto: nomeProduto,
                        urlProduto: urlProduto,
                        urlImagem: urlImagem,
                        valorProduto: valorProduto,
                        descricao: descricao
                    };
    
                if(!nomeProduto.length){
                    alert("insira um produto valido");
                } else {
                    alert("produto cadastrado");
                    var primeirapagina = document.querySelector('#primeirapagina');
                    primeirapagina.classList.remove('hidden');
                    socket.emit('sendProduto', produtoObject );
                    goToHome();
                }
    
            });

            function goToHome(produto) {
            //hidden ta tela novoproduto
            var telanovoproduto = document.querySelector('#telanovoproduto');
            telanovoproduto.classList.add('hidden');
            //hidden ta tela chat
            var telachat = document.querySelector('#telachat');
            telachat.classList.add('hidden');            
            //remove hidden ta tela menu
            var primeirapagina = document.querySelector('#primeirapagina');
            primeirapagina.classList.remove('hidden');
        }

    </script>

</body>
</html>

